import{r as I,j as t}from"./index-2V3apa4J.js";import{a as A,u as v,g as w,c as C}from"./KcPage-BHIuFUt6.js";import{w as y}from"./waitForElementMountedOnDom-qpCjLZnq.js";A();A();function S(m){const{authButtonId:i,kcContext:l,i18n:o}=m,{url:p,isUserIdentified:d,challenge:e,userVerification:u,rpId:j,createTimeout:g}=l,{msgStr:c,isFetchingTranslations:h}=o,{insertScriptTags:a}=v({componentOrHookName:"WebauthnAuthenticate",scriptTags:[{type:"module",textContent:()=>`

                    import { authenticateByWebAuthn } from "${p.resourcesPath}/js/webauthnAuthenticate.js";
                    const authButton = document.getElementById('${i}');
                    authButton.addEventListener("click", function() {
                        const input = {
                            isUserIdentified : ${d},
                            challenge : '${e}',
                            userVerification : '${u}',
                            rpId : '${j}',
                            createTimeout : ${g},
                            errmsg : ${JSON.stringify(c("webauthn-unsupported-browser-text"))}
                        };
                        authenticateByWebAuthn(input);
                    });
                `}]});I.useEffect(()=>{h||(async()=>(await y({elementId:i}),a()))()},[h])}function F(m){const{kcContext:i,i18n:l,doUseDefaultCss:o,Template:p,classes:d}=m,{kcClsx:e}=w({doUseDefaultCss:o,classes:d}),{url:u,realm:j,registrationDisabled:g,authenticators:c,shouldDisplayAuthenticators:h}=i,{msg:a,msgStr:N,advancedMsg:k}=l,f="authenticateWebAuthnButton";return S({authButtonId:f,kcContext:i,i18n:l}),t.jsx(p,Object.assign({kcContext:i,i18n:l,doUseDefaultCss:o,classes:d,displayInfo:j.registrationAllowed&&!g,infoNode:t.jsx("div",Object.assign({id:"kc-registration"},{children:t.jsxs("span",{children:[a("noAccount")," ",t.jsx("a",Object.assign({tabIndex:6,href:u.registrationUrl},{children:a("doRegister")}))]})})),headerNode:a("webauthn-login-title")},{children:t.jsxs("div",Object.assign({id:"kc-form-webauthn",className:e("kcFormClass")},{children:[t.jsxs("form",Object.assign({id:"webauth",action:u.loginAction,method:"post"},{children:[t.jsx("input",{type:"hidden",id:"clientDataJSON",name:"clientDataJSON"}),t.jsx("input",{type:"hidden",id:"authenticatorData",name:"authenticatorData"}),t.jsx("input",{type:"hidden",id:"signature",name:"signature"}),t.jsx("input",{type:"hidden",id:"credentialId",name:"credentialId"}),t.jsx("input",{type:"hidden",id:"userHandle",name:"userHandle"}),t.jsx("input",{type:"hidden",id:"error",name:"error"})]})),t.jsxs("div",Object.assign({className:C(e("kcFormGroupClass"),"no-bottom-margin")},{children:[c&&t.jsxs(t.Fragment,{children:[t.jsx("form",Object.assign({id:"authn_select",className:e("kcFormClass")},{children:c.authenticators.map(s=>t.jsx("input",{type:"hidden",name:"authn_use_chk",value:s.credentialId}))})),h&&t.jsxs(t.Fragment,{children:[c.authenticators.length>1&&t.jsx("p",Object.assign({className:e("kcSelectAuthListItemTitle")},{children:a("webauthn-available-authenticators")})),t.jsx("div",Object.assign({className:e("kcFormOptionsClass")},{children:c.authenticators.map((s,r)=>{var b;return t.jsxs("div",Object.assign({id:`kc-webauthn-authenticator-item-${r}`,className:e("kcSelectAuthListItemClass")},{children:[t.jsx("div",Object.assign({className:e("kcSelectAuthListItemIconClass")},{children:t.jsx("i",{className:C((()=>{const n=e(s.transports.iconClass);return n===s.transports.iconClass?e("kcWebAuthnDefaultIcon"):n})(),e("kcSelectAuthListItemIconPropertyClass"))})})),t.jsxs("div",Object.assign({className:e("kcSelectAuthListItemArrowIconClass")},{children:[t.jsx("div",Object.assign({id:`kc-webauthn-authenticator-label-${r}`,className:e("kcSelectAuthListItemHeadingClass")},{children:k(s.label)})),((b=s.transports.displayNameProperties)===null||b===void 0?void 0:b.length)&&t.jsx("div",Object.assign({id:`kc-webauthn-authenticator-transport-${r}`,className:e("kcSelectAuthListItemDescriptionClass")},{children:s.transports.displayNameProperties.map((n,x,O)=>({displayNameProperty:n,hasNext:x!==O.length-1})).map(({displayNameProperty:n,hasNext:x})=>t.jsxs(I.Fragment,{children:[k(n),x&&t.jsx("span",{children:", "})]},n))})),t.jsxs("div",Object.assign({className:e("kcSelectAuthListItemDescriptionClass")},{children:[t.jsx("span",Object.assign({id:`kc-webauthn-authenticator-createdlabel-${r}`},{children:a("webauthn-createdAt-label")})),t.jsx("span",Object.assign({id:`kc-webauthn-authenticator-created-${r}`},{children:s.createdAt}))]})),t.jsx("div",{className:e("kcSelectAuthListItemFillClass")})]}))]}),r)})}))]})]}),t.jsx("div",Object.assign({id:"kc-form-buttons",className:e("kcFormButtonsClass")},{children:t.jsx("input",{id:f,type:"button",autoFocus:!0,value:N("webauthn-doAuthenticate"),className:e("kcButtonClass","kcButtonPrimaryClass","kcButtonBlockClass","kcButtonLargeClass")})}))]}))]}))}))}export{F as default};
